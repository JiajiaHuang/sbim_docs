name: åŒæ­¥æ–‡æ¡£å¹¶è§¦å‘ç½‘ç«™æ›´æ–°

on:
  push:
    branches: [ main ]
    paths:
      - '**'
  workflow_dispatch:

jobs:
  sync-docs-and-trigger-update:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºæ–‡æ¡£ä»“åº“
        uses: actions/checkout@v4
        with:
          path: sbim_docs

      - name: æ£€å‡ºç½‘ç«™ä»“åº“
        uses: actions/checkout@v4
        with:
          repository: JiajiaHuang/sbim_web
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          path: sbim_web

      - name: åŒæ­¥æ–‡æ¡£å†…å®¹åˆ°ç½‘ç«™ä»“åº“
        run: |
          echo "ğŸ”„ å¼€å§‹åŒæ­¥æ–‡æ¡£å†…å®¹..."
          
          # æ¸…ç©ºç½‘ç«™ä»“åº“çš„ docs ç›®å½•
          rm -rf sbim_web/docs/*
          
          # å¤åˆ¶æ–‡æ¡£ä»“åº“çš„å†…å®¹åˆ°ç½‘ç«™ä»“åº“
          cp -r sbim_docs/docs/* sbim_web/docs/
          cp -r sbim_docs/api/* sbim_web/docs/api/ 2>/dev/null || echo "æ²¡æœ‰ api ç›®å½•ï¼Œè·³è¿‡"
          
          echo "ğŸ“ åŒæ­¥çš„æ–‡ä»¶åˆ—è¡¨:"
          ls -la sbim_web/docs/

      - name: é…ç½® Git ç”¨æˆ·ä¿¡æ¯
        run: |
          cd sbim_web
          git config user.name "Jiaheng"
          git config user.email "569249477@qq.com"

      - name: æäº¤æ–‡æ¡£æ›´æ–°åˆ°ç½‘ç«™ä»“åº“
        run: |
          cd sbim_web
          git add docs/
          
          if git diff --staged --quiet; then
            echo "ğŸ“ æ²¡æœ‰æ–‡æ¡£å†…å®¹å˜åŒ–ï¼Œè·³è¿‡æäº¤"
          else
            git commit -m "docs: è‡ªåŠ¨åŒæ­¥æ–‡æ¡£å†…å®¹

æ¥æºæäº¤: ${{ github.repository }}@${{ github.sha }}
æäº¤è€…: ${{ github.actor }}
åŒæ­¥æ—¶é—´: $(date -u '+%Y-%m-%d %H:%M:%S UTC')

è‡ªåŠ¨ä»æ–‡æ¡£ä»“åº“åŒæ­¥æœ€æ–°å†…å®¹åˆ°ç½‘ç«™ä»“åº“"
            
            git push origin main
            echo "âœ… æ–‡æ¡£å†…å®¹å·²åŒæ­¥åˆ°ç½‘ç«™ä»“åº“"
          fi

      - name: è®°å½•åŒæ­¥ä¿¡æ¯
        run: |
          echo "âœ… æ–‡æ¡£åŒæ­¥å®Œæˆ"
          echo "ğŸ“ æ–‡æ¡£ä»“åº“æäº¤: ${{ github.sha }}"
          echo "ğŸ‘¤ æäº¤è€…: ${{ github.actor }}"
          echo "ğŸŒ¿ åˆ†æ”¯: ${{ github.ref }}"
          echo "ï¿½ï¿½ ç½‘ç«™å°†è‡ªåŠ¨é‡æ–°éƒ¨ç½²"
